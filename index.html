<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡∏•‡∏≤‡∏á | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ 30 ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</title>
  <style>
    body {
      font-family: 'Kanit', sans-serif;
      padding: 20px;
      background: #f7f7f7;
      color: #2d3436;
      max-width: 600px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
      color: #2c3e50;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      padding: 10px;
      margin-bottom: 5px;
      border-radius: 6px;
    }
    .paid li {
      background-color: #d0f0c0;
    }
    .unpaid li {
      background-color: #ffeaa7;
    }
    .date-box {
      text-align: center;
      margin-bottom: 20px;
      font-weight: bold;
      color: #636e72;
    }
  </style>
</head>
<body>
  <h1>üìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ 30 ‡∏Ñ‡∏ô</h1>
  <div class="date-box">‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span id="todayDate"></span></div>

  <h2>‚úÖ ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</h2>
  <ul id="paidList" class="paid"></ul>

  <h2>‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢</h2>
  <ul id="unpaidList" class="unpaid"></ul>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { firebaseConfig } from "./firebase-config.js";

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYY-MM-DD
    const today = new Date().toISOString().slice(0, 10);
    document.getElementById("todayDate").textContent = today;

    const paidList = document.getElementById("paidList");
    const unpaidList = document.getElementById("unpaidList");

    async function checkPayments() {
      try {
        // 1. ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å collection "users"
        const userSnapshot = await getDocs(collection(db, "users"));
        let allUsers = userSnapshot.docs
          .map(doc => doc.data().nickname)
          .filter(n => n && typeof n === 'string');

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
        allUsers.sort((a, b) => a.localeCompare(b, 'th'));

        // 2. ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        const paymentSnapshot = await getDocs(
          query(collection(db, "payments"), where("date", "==", today))
        );

        const paidNicknames = new Set(
          paymentSnapshot.docs
            .map(doc => doc.data().nickname)
            .filter(n => n && allUsers.includes(n))
        );

        // 3. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô paid ‡πÅ‡∏•‡∏∞ unpaid
        allUsers.forEach(nickname => {
          const li = document.createElement("li");
          li.textContent = nickname;

          if (paidNicknames.has(nickname)) {
            paidList.appendChild(li);
          } else {
            unpaidList.appendChild(li);
          }
        });
      } catch (error) {
        console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:", error);
      }
    }

    checkPayments();
  </script>
</body>
</html>
